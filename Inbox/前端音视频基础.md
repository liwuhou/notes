![](http://cdn.liwuhou.cn/tmp/20220716212124.png)

围绕音频和视频的基础概念、容器格式和编码格式展开对每个涉及到的知识点进行具体的总结

# 视频

| 基本概念                   | 窗口格式                                | 编码格式               |
| -------------------------- | --------------------------------------- | ---------------------- |
| 码率、帧率、压缩率、分辨率 | MP4、AVI、FLV、TS，M3U8、WebM、OGV、MOV | H.265、H.264、AV1、VP9 |

从时间顺序上，不同厂商对应的编码标准的发展

![](http://cdn.liwuhou.cn/tmp/20220716224748.png)

常见的视频容器格式对应编码

| 窗口格式 | 视频编码            | 音频编码       |
| -------- | ------------------- | -------------- |
| mp4      | mpeg4或h.264或h.265 | mpeg4 aac      |
| avi      | mpeg4               | mp3或pcm_s161e |
| wmv      | wmv3x               | wma7x          |

## 基础概念
简单介绍下视频中的一些基础概念

### 码率

码率是指单位时间内，视频的取样率。取样率越大，精度就越高，处理出来的文件也就越大越接近原始文件。一般使用的单位是 kbps（千位每秒）。

比特率又称“二进制位速率”，俗称码率，每秒传送的比特数，又称数据信号速率。

比特/秒（bit/s 或 bps）、千比特/秒（kbit/s 或 kbps，k=1000）或兆比特/秒（Mbit/s 或 Mbps，1Mbps=1000kbps）。比特率越高，表示单位时间传送的数据就越多。

#### 视频码率计算公式
$$码率（kbps）= 文件大小（KB） * 8 / 时间（s）$$

举个例子：D5 碟，容量为 4.3G，其中考虑到音频的不同格式，算为 600M（故剩余容量为 4.3 * 1024 - 600 = 3803.2M），所以视频文件应不大于 3.7G，本例中取视频文件的容量为 3.446G，视频长度 100 分钟（6000 秒），计算结果：码率约等于 4818kbps（3.44 * 1024 * 1024 * 8 / 6000 = 4817.857）。

#### 码率与编码方式的关系
在分辨率固定的条件下，清晰度与码率的关系：

![](http://cdn.liwuhou.cn/tmp/20220716232157.png)

H.265 与 H.264 编码下不同分辨率对应的推荐码率上限：
<table>
  <tr>
    <td>编码方式</td>
    <td>分辨率</td>
    <td>推荐码率上限</td>
  </tr>
  <tr>
    <td rowspan="6">H.265</td>
    <td>2048 * 1536</td>
    <td>3M</td>
  </tr>
  <tr>
    <td>1920 * 1080</td>
    <td>2M</td>
  </tr>
  <tr>
    <td>1280 * 960</td>
    <td>1M</td>
  </tr>
  <tr>
    <td>1280 * 720</td>
    <td>1M</td>
  </tr>
  <tr>
    <td>740 * 576</td>
    <td>0.75M</td>
  </tr>
  <tr>
    <td>352 * 288</td>
    <td>0.25M</td>
  </tr>
  <tr>
    <td rowspan="6">H.264</td>
    <td>2048 * 1536</td>
    <td>6M</td>
  </tr>
  <tr>
    <td>1920 * 1080</td>
    <td>4M</td>
  </tr>
  <tr>
    <td>1280 * 960</td>
    <td>2M</td>
  </tr>
  <tr>
    <td>1280 * 720</td>
    <td>2M</td>
  </tr>
  <tr>
    <td>740 * 576</td>
    <td>1.5M</td>
  </tr>
  <tr>
    <td>352 * 288</td>
    <td>0.5M</td>
  </tr>
</table>

#### 码率对应视频质量

16 kbps — 可视电话质量（使用者可以接受的"说话的头"照片的最低要求）

128 ~ 384 kbps — 商业导向的视频会议系统质量

1 Mbps — VHS质量

1.25 Mbps — VCD质量（使用 MPEG1 压缩）

5 Mbps — DVD质量（使用 MPEG2 压缩）

8 ~ 15 Mbps — 高清晰度电视（HDTV） 质量（使用 H.264 压缩）

29.4 Mbps — HD DVD 质量

40 Mbps — 蓝光光碟（Blu-ray Disc） 质量（使用 MPEG2、H.264 或 VC-1 压缩）

440/880 Mbps – Sony HDCAM SR质量（SQ/HQ）

### 帧率

帧率越高，视频的流畅度就越高，在视觉上就越不容易觉察到卡顿。每秒钟帧数（FPS）越多，所显示的动作就会越流畅

#### 定义
视频帧率（Frame rate）：用于测量显示帧数的量度，也可以理解为图形处理器每秒能刷新几次

#### 单位
测量单位为每秒显示的帧数（Frames per Second，FPS）或赫兹（Hz）


### 压缩率
在多媒体的传输中，为了节省带宽和低时延，会对传输文件进行一定的压缩。压缩率即经过压缩后文件的大小 / 原始文件的大小 * 100%
压缩率一般来说是越小越好，但相对的，文件压缩得越小，解压的时间也就相应越长。

#### 压缩编码
原始视频压缩的目的是尽可能的去除冗余信息，可以去除的冗余包括：
- 空间冗余：图像相邻像素之间有较强的相关性
- 时间冗余：视频序列的相邻图像之间的内容相似性
- 编码冗余：不同像素值出现的概率不同
- 视觉冗余：人的视觉系统对某些细节不敏感
- 知识冗余：规律性的结构可由先验知识和背景知识知道

视频压缩编码的方法：
- 变换编码
- 熵编码
- 运动估计和运动补偿
- 混合编码

#### 常见编码格式压缩率

举例：初步文件 3840x2160.yuv（大小：3.6GB，分辨率：3840x2160 4k 帧率：25fps，码率：10Mps），使用H.265 编码方式压缩后文件大小为 15MB

H.265 编码方式下，压缩文件：15MB，压缩率为：`15 / 3600 * 100% ≈ 0.42%`
H.264 编码方式下，压缩率是H.265 的 二分之一

### 分辨率

常见的分辨率：
![](http://cdn.liwuhou.cn/tmp/20220716235034.png)

<sub>备注：SD 标准清晰度：Standard Definition, FHD 全高清：Full High Definition，UHD 超高清 Ultra High Definition<sub>

#### 定义
视频分辨率：是用于度量图像内数据量多少的一个参数，通常表示成 ppi

#### 单位
描述分辨率的单位有：dpi（点每英寸）、lpi（线每英寸）、ppi（像素每英寸）和 PPD（PPPixels Per Degree 角分辨率，像素每度）

## 窗口格式

### MP4
MP4 或称 MPEG-4 第 14 部分（MPEG-4 Part 14）是一种标准的数字多媒体窗口格式，由国际标准化组织（ISO）和国际电工委员会（IEC）下属的“动态图像专家组”（Moving Picture Experts Group，即 MPEG）制定

MP4 文件格式是一个十分开放的容器，几乎可以用来描述所有的媒体结构，MP4 文件中的媒体描述与媒体数据是分开的，并且媒体数据的组织也很自由，不一定要按照时间顺序排列，甚至媒体数据可以直接引用其他文件。MP4 支持流媒体。MP4 目前被广泛用于封装 H.264/H.265视频和 AAC 音频，是高清视频的代表。

![](http://cdn.liwuhou.cn/tmp/20220717000229.png)

#### 历史演进

- 2001 年，Apple 的 QuickTime 格式，`.qt`和`.mov` 后缀名
- 2001 年，MPEG-4 Part1，把基于 QuickTime 的 box 布局的容器格式添加到了 MPEG-4 标准
- 2004 年，标准文档把编码和容器格式的说明分开了

MPEG-4 Part 12，定义了容器格式通用的 box 结构，即 ISO 媒体文件格式（ISO base media fille format）。
MPEG-4 Part 14，基于 Part 12 进行了细化，定义了用于存储 MPEG-4内容的容器格式，即 `.mp4` 格式

